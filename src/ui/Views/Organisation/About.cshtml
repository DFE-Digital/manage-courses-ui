@model OrganisationViewModel

@{
  Layout = "Shared/_TabViewLayout";
  ViewBag.Title = Model.TabViewModel.OrganisationName;
  var train_with_us = ViewData.ModelState["TrainWithUs"] != null && ViewData.ModelState["TrainWithUs"].Errors.Any();
  var about_training_provider = ViewData.ModelState["AboutTrainingProvider"] != null && ViewData.ModelState["AboutTrainingProvider"].Errors.Any();
  var train_with_disability = ViewData.ModelState["TrainWithDisability"] != null && ViewData.ModelState["TrainWithDisability"].Errors.Any();
  var workflowStatus = Model.GetWorkflowStatus();
}

<section class="govuk-tabs__panel--without-border">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h2 class="govuk-heading-l">About your organisation</h2>
      <form asp-controller="Organisation" asp-action="About" method="post">
        <input type="hidden" asp-for="@Model.PublishOrganisation" value="false"></input>
        <input type="hidden" asp-for="@Model.InstitutionCode"></input>
        @Html.Partial("ErrorSummary")
        <p class="govuk-body">This is your chance to tell applicants why they should choose to train with you. You could describe any advantages and special
        features of you as a training provider.</p>
        <p class="govuk-body">You must be specific and factual with any claims you make, and support them with evidence. For example:</p>
        <ul>
          <li>don’t say “our students are some of the happiest in the country”</li>
          <li> do say “the Times Educational Supplement ranked our students as 4th happiest in the country”</li>
        </ul>
        <div id="TrainWithUs-wrapper" class="govuk-form-group govuk-character-count @(train_with_us ? "govuk-form-group--error" : " ")" data-module="character-count" data-maxwords="250">
          <label asp-for="TrainWithUs" class="govuk-label govuk-!-font-weight-bold">Training with you</label>
          @if (train_with_us) {
            <span asp-validation-for="TrainWithUs" class="govuk-error-message"></span>
          }
          <textarea asp-for="TrainWithUs" class="govuk-textarea js-character-count" rows="15" data-module="character-count"></textarea>
        </div>

        @if(Model.AboutTrainingProviders.Any()) {
          <h2 class="govuk-heading-l">About your accrediting provider</h2>
          <p class="govuk-body">Describe advantages and special features of your accrediting provider. You must be specific and factual with any claims you make, and support them with evidence.</p>

          @for(int i = 0; i < Model.AboutTrainingProviders.Count; i++) {
            <div id="AboutTrainingProviders-wrapper" class="govuk-form-group govuk-character-count"  data-module="character-count" data-maxwords="100">
              <input type="hidden" asp-for="@Model.AboutTrainingProviders[i].InstitutionCode"></input>
              <label class="govuk-label govuk-!-font-weight-bold" asp-for="@Model.AboutTrainingProviders[i].Description">
                @Model.AboutTrainingProviders[i].InstitutionName (optional)
              </label>
              <textarea class="govuk-textarea js-character-count" rows="10" asp-for="@Model.AboutTrainingProviders[i].Description"></textarea>
            </div>
          }
        }

        <h2 class="govuk-heading-l">Training with disabilities and other needs</h2>
        <p class="govuk-body">Say how you support candidates with disabilities and other needs. This could include candidates with:</p>
        <ul class="govuk-list govuk-list--bullet">
          <li>dyslexia</li>
          <li>physical, hearing and visual impairments</li>
          <li>mental health conditions</li>
        </ul>
        <p class="govuk-body">If accessibility varies between locations, give details. It’s also useful to candidates to know how you’ve accommodated others with specific access needs in the past.</p>
        <div id="TrainWithDisability-wrapper" class="govuk-form-group @(train_with_disability ? "govuk-form-group--error" : "")">
          <label asp-for="TrainWithDisability" class="govuk-label govuk-!-font-weight-bold">Training with disabilities and other needs</label>
          @if (train_with_disability) {
            @Html.ValidationMessageFor(m => m.TrainWithDisability, "", new { @class="govuk-error-message" })
          }
          <textarea asp-for="TrainWithDisability" class="govuk-textarea js-character-count" rows="15"></textarea>
        </div>
        <div class="form-group">
          <input type="submit" class="govuk-button" value="Save" />
        </div>
        <div class="form-group">
          <a href="@Url.Action("About", "Organisation")" class="govuk-link">Cancel changes</a>
        </div>
      </form>
    </div>
    <div class="govuk-grid-column-one-third">

      <aside class="related">
        @switch(workflowStatus)
        {
          case WorkflowStatus.Blank :
            <p class="govuk-body">You need to complete and publish this information.</p>

            break;
          case WorkflowStatus.InitialDraft :
            <p class="govuk-body">You have unpublished changes.</p>

            <hr class="related__section-break">
            <h4 class="govuk-heading-m">Publish</h4>
            <p class="govuk-body">New information will show on all @Model.TabViewModel.OrganisationName courses.</p>
            <form asp-controller="Organisation" asp-action="about" method="post">
              <input type="submit" class="govuk-button" value="Publish" />
              <input type="hidden" asp-for="@Model.PublishOrganisation" value="true"></input>
            </form>
            break;
          case WorkflowStatus.Published :
            <p class="govuk-body">Last published on @Model.LastPublishedTimestampUtc.DateString()</p>

            break;
          case WorkflowStatus.SubsequenceDraft :
            <p class="govuk-body">Last published on @Model.LastPublishedTimestampUtc.DateString()</p>
            <p class="govuk-body">You have unpublished changes.</p>

            <hr class="related__section-break">
            <h4 class="govuk-heading-m">Publish</h4>
            <p class="govuk-body">New information will show on all @Model.TabViewModel.OrganisationName courses.</p>

            <form asp-controller="Organisation" asp-action="about" method="post">
              <input type="hidden" asp-for="@Model.PublishOrganisation" value="true"></input>
              <input type="submit" class="govuk-button" value="Publish" />
            </form>
            break;
          case WorkflowStatus.BlankSubsequenceDraft :
            <p class="govuk-body">Last published on @Model.LastPublishedTimestampUtc.DateString()</p>
            <p class="govuk-body">You need to complete and publish this information.</p>
            break;
          default:
            break;
        }
      </aside>

    </div>
  </div>
</section>
